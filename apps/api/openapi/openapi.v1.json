{
  "openapi": "3.1.0",
  "info": {
    "title": "The DMZ API",
    "description": "Backend API for The DMZ: Archive Gate cybersecurity training platform",
    "version": "1.0.0",
    "contact": {
      "name": "Matrices GmbH"
    },
    "license": {
      "name": "Proprietary - Matrices GmbH"
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      },
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "refresh-token"
      },
      "csrfToken": {
        "type": "apiKey",
        "in": "header",
        "name": "x-csrf-token"
      }
    },
    "schemas": {}
  },
  "paths": {
    "/docs/json": {
      "get": {
        "responses": {
          "200": {
            "description": "Default Response"
          }
        }
      }
    },
    "/docs/yaml": {
      "get": {
        "responses": {
          "200": {
            "description": "Default Response"
          }
        }
      }
    },
    "/api/v1/": {
      "get": {
        "responses": {
          "200": {
            "description": "Default Response"
          }
        }
      }
    },
    "/health": {
      "get": {
        "parameters": [
          {
            "schema": {
              "type": "string",
              "enum": ["liveness", "readiness"]
            },
            "in": "query",
            "name": "probe",
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["ok"]
                    }
                  },
                  "required": ["status"],
                  "additionalProperties": false
                }
              }
            }
          }
        }
      }
    },
    "/ready": {
      "get": {
        "parameters": [
          {
            "schema": {
              "type": "string",
              "enum": ["liveness", "readiness"]
            },
            "in": "query",
            "name": "probe",
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["ok", "degraded"]
                    },
                    "checks": {
                      "type": "object",
                      "properties": {
                        "database": {
                          "type": "object",
                          "properties": {
                            "ok": {
                              "type": "boolean"
                            },
                            "message": {
                              "type": "string"
                            }
                          },
                          "required": ["ok", "message"],
                          "additionalProperties": false
                        },
                        "redis": {
                          "type": "object",
                          "properties": {
                            "ok": {
                              "type": "boolean"
                            },
                            "message": {
                              "type": "string"
                            }
                          },
                          "required": ["ok", "message"],
                          "additionalProperties": false
                        }
                      },
                      "required": ["database", "redis"],
                      "additionalProperties": false
                    }
                  },
                  "required": ["status", "checks"],
                  "additionalProperties": false
                }
              }
            }
          },
          "503": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["ok", "degraded"]
                    },
                    "checks": {
                      "type": "object",
                      "properties": {
                        "database": {
                          "type": "object",
                          "properties": {
                            "ok": {
                              "type": "boolean"
                            },
                            "message": {
                              "type": "string"
                            }
                          },
                          "required": ["ok", "message"],
                          "additionalProperties": false
                        },
                        "redis": {
                          "type": "object",
                          "properties": {
                            "ok": {
                              "type": "boolean"
                            },
                            "message": {
                              "type": "string"
                            }
                          },
                          "required": ["ok", "message"],
                          "additionalProperties": false
                        }
                      },
                      "required": ["database", "redis"],
                      "additionalProperties": false
                    }
                  },
                  "required": ["status", "checks"],
                  "additionalProperties": false
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/register": {
      "post": {
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 12,
                    "maxLength": 128
                  },
                  "displayName": {
                    "type": "string",
                    "minLength": 2,
                    "maxLength": 64
                  }
                },
                "required": ["email", "password", "displayName"],
                "additionalProperties": false
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "displayName": {
                          "type": "string"
                        },
                        "tenantId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "role": {
                          "type": "string"
                        },
                        "isActive": {
                          "type": "boolean"
                        }
                      },
                      "required": ["id", "email", "displayName", "tenantId", "role", "isActive"],
                      "additionalProperties": false
                    },
                    "accessToken": {
                      "type": "string"
                    }
                  },
                  "required": ["user", "accessToken"],
                  "additionalProperties": false
                }
              }
            }
          },
          "403": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["TENANT_INACTIVE"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "properties": {
                            "tenantId": {
                              "type": "string"
                            },
                            "tenantStatus": {
                              "type": "string"
                            }
                          }
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/login": {
      "post": {
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 8,
                    "maxLength": 128
                  }
                },
                "required": ["email", "password"],
                "additionalProperties": false
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "displayName": {
                          "type": "string"
                        },
                        "tenantId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "role": {
                          "type": "string"
                        },
                        "isActive": {
                          "type": "boolean"
                        }
                      },
                      "required": ["id", "email", "displayName", "tenantId", "role", "isActive"],
                      "additionalProperties": false
                    },
                    "accessToken": {
                      "type": "string"
                    }
                  },
                  "required": ["user", "accessToken"],
                  "additionalProperties": false
                }
              }
            }
          },
          "403": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["TENANT_INACTIVE"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "properties": {
                            "tenantId": {
                              "type": "string"
                            },
                            "tenantStatus": {
                              "type": "string"
                            }
                          }
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/refresh": {
      "post": {
        "security": [
          {
            "cookieAuth": []
          },
          {
            "csrfToken": []
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string"
                    }
                  },
                  "required": ["accessToken"],
                  "additionalProperties": false
                }
              }
            }
          },
          "403": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["TENANT_INACTIVE"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "properties": {
                            "tenantId": {
                              "type": "string"
                            },
                            "tenantStatus": {
                              "type": "string"
                            }
                          }
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/logout": {
      "delete": {
        "security": [
          {
            "bearerAuth": []
          },
          {
            "cookieAuth": []
          },
          {
            "csrfToken": []
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    }
                  },
                  "required": ["success"]
                }
              }
            }
          },
          "403": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["TENANT_INACTIVE"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "properties": {
                            "tenantId": {
                              "type": "string"
                            },
                            "tenantStatus": {
                              "type": "string"
                            }
                          }
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/me": {
      "get": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "displayName": {
                          "type": "string"
                        },
                        "tenantId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "role": {
                          "type": "string"
                        },
                        "isActive": {
                          "type": "boolean"
                        }
                      },
                      "required": ["id", "email", "displayName", "tenantId", "role", "isActive"],
                      "additionalProperties": false
                    },
                    "profile": {
                      "type": "object",
                      "properties": {
                        "profileId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "tenantId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "userId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "locale": {
                          "type": "string",
                          "maxLength": 10
                        },
                        "timezone": {
                          "type": "string",
                          "maxLength": 64
                        },
                        "accessibilitySettings": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "notificationSettings": {
                          "type": "object",
                          "additionalProperties": {}
                        }
                      },
                      "required": [
                        "profileId",
                        "tenantId",
                        "userId",
                        "locale",
                        "timezone",
                        "accessibilitySettings",
                        "notificationSettings"
                      ],
                      "additionalProperties": false
                    },
                    "permissions": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "roles": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": ["user", "permissions", "roles"],
                  "additionalProperties": false
                }
              }
            }
          },
          "403": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["TENANT_INACTIVE"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "properties": {
                            "tenantId": {
                              "type": "string"
                            },
                            "tenantStatus": {
                              "type": "string"
                            }
                          }
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/profile": {
      "patch": {
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "locale": {
                    "type": "string",
                    "maxLength": 10
                  },
                  "timezone": {
                    "type": "string",
                    "maxLength": 64
                  },
                  "accessibilitySettings": {
                    "type": "object",
                    "additionalProperties": {}
                  },
                  "notificationSettings": {
                    "type": "object",
                    "additionalProperties": {}
                  }
                },
                "additionalProperties": false
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "profileId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "tenantId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "userId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "locale": {
                      "type": "string",
                      "maxLength": 10
                    },
                    "timezone": {
                      "type": "string",
                      "maxLength": 64
                    },
                    "accessibilitySettings": {
                      "type": "object",
                      "additionalProperties": {}
                    },
                    "notificationSettings": {
                      "type": "object",
                      "additionalProperties": {}
                    }
                  },
                  "required": [
                    "profileId",
                    "tenantId",
                    "userId",
                    "locale",
                    "timezone",
                    "accessibilitySettings",
                    "notificationSettings"
                  ],
                  "additionalProperties": false
                }
              }
            }
          },
          "400": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["VALIDATION_FAILED"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object"
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          },
          "403": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["TENANT_INACTIVE"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "properties": {
                            "tenantId": {
                              "type": "string"
                            },
                            "tenantStatus": {
                              "type": "string"
                            }
                          }
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          },
          "404": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["NOT_FOUND", "RESOURCE_NOT_FOUND", "TENANT_NOT_FOUND"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object"
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/health/authenticated": {
      "get": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "tenantId": {
                          "type": "string"
                        },
                        "role": {
                          "type": "string"
                        }
                      },
                      "required": ["id", "tenantId", "role"]
                    }
                  },
                  "required": ["status", "user"]
                }
              }
            }
          },
          "403": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "enum": [false]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "enum": ["TENANT_INACTIVE"]
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "properties": {
                            "tenantId": {
                              "type": "string"
                            },
                            "tenantStatus": {
                              "type": "string"
                            }
                          }
                        },
                        "requestId": {
                          "type": "string"
                        }
                      },
                      "required": ["code", "message", "details"]
                    }
                  },
                  "required": ["success", "error"]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/admin/users": {
      "get": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "email": {
                            "type": "string",
                            "format": "email"
                          },
                          "displayName": {
                            "type": "string"
                          },
                          "role": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "properties": {
                        "success": {
                          "type": "boolean",
                          "enum": [false]
                        },
                        "error": {
                          "type": "object",
                          "properties": {
                            "code": {
                              "type": "string",
                              "enum": [
                                "AUTH_FORBIDDEN",
                                "AUTH_INSUFFICIENT_PERMS",
                                "TENANT_INACTIVE"
                              ]
                            },
                            "message": {
                              "type": "string"
                            },
                            "details": {
                              "type": "object"
                            },
                            "requestId": {
                              "type": "string"
                            }
                          },
                          "required": ["code", "message", "details"]
                        }
                      },
                      "required": ["success", "error"]
                    },
                    {
                      "type": "object",
                      "properties": {
                        "success": {
                          "type": "boolean",
                          "enum": [false]
                        },
                        "error": {
                          "type": "object",
                          "properties": {
                            "code": {
                              "type": "string",
                              "enum": ["TENANT_INACTIVE"]
                            },
                            "message": {
                              "type": "string"
                            },
                            "details": {
                              "type": "object",
                              "properties": {
                                "tenantId": {
                                  "type": "string"
                                },
                                "tenantStatus": {
                                  "type": "string"
                                }
                              }
                            },
                            "requestId": {
                              "type": "string"
                            }
                          },
                          "required": ["code", "message", "details"]
                        }
                      },
                      "required": ["success", "error"]
                    }
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "servers": [
    {
      "url": "http://localhost:3001",
      "description": "Local development"
    }
  ]
}
