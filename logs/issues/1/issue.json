{"assignees":[],"author":{"id":"MDQ6VXNlcjIyODUzMjIy","is_bot":false,"login":"TheMorpheus407","name":"The Morpheus Tutorials"},"body":"## Summary\nSet up the root monorepo structure using pnpm workspaces with Turborepo for build orchestration. This is the foundational issue that all other M0 work depends on.\n\n## Requirements\n\n### Monorepo Structure\n```\nthe-dmz/\n├── apps/\n│   ├── web/          # SvelteKit frontend (Svelte 5)\n│   └── api/          # Fastify backend (Node.js/TypeScript)\n├── packages/\n│   └── shared/       # Shared types, validation schemas, constants\n├── package.json      # Root workspace config\n├── pnpm-workspace.yaml\n├── turbo.json        # Turborepo pipeline config\n├── tsconfig.base.json # Shared TypeScript config\n├── .npmrc\n└── .nvmrc            # Node.js version pin (LTS 22.x)\n```\n\n### Root `package.json`\n- pnpm workspaces configuration\n- Shared dev scripts: `dev`, `build`, `lint`, `test`, `typecheck`, `clean`\n- Engine constraints: Node.js >= 22, pnpm >= 9\n\n### `pnpm-workspace.yaml`\n- Define workspace packages: `apps/*`, `packages/*`\n\n### `turbo.json`\n- Pipeline definitions for: `build`, `dev`, `lint`, `test`, `typecheck`\n- Proper dependency graph (build depends on ^build for packages)\n- Dev task as persistent\n- Cache configuration for build artifacts\n\n### `.nvmrc`\n- Pin to Node.js 22 LTS\n\n### `.npmrc`\n- `strict-peer-dependencies=true`\n- `auto-install-peers=true`\n\n## Acceptance Criteria\n- [ ] `pnpm install` completes without errors from root\n- [ ] `pnpm -w run` shows all workspace scripts\n- [ ] Workspace packages can import from each other\n- [ ] Turborepo correctly orders build tasks\n- [ ] Node.js version is pinned to 22 LTS\n\n## References\n- MILESTONES.md: M0 \"Monorepo structure\" deliverable\n- DD-08 Section 7: Project Structure and Module Boundaries\n- DD-09 Section 1.2: Module Directory Structure\n- DD-14 Section 12: Environment Strategy\n\n## Dependencies\nNone (first issue)\n\n## Blocks\nAll other M0 issues\n\n---","comments":[{"id":"IC_kwDOQ_FFzs7lxQhd","author":{"login":"TheMorpheus407"},"authorAssociation":"OWNER","body":"# Research: M0-01 Initialize pnpm monorepo workspace\n\n## Summary\nThe repository is documentation-only today (no `apps/`, `packages/`, `package.json`, or workspace configuration). Issue #1 is the foundational bootstrap for all other M0 items, and must establish the pnpm/Turborepo workspace skeleton with Node 22 pinning and strict npm settings. The required structure and naming are consistent with DD-08 (frontend structure), DD-09 (backend module layout), and DD-14 (environment strategy), and MILESTONES.md explicitly calls out “Monorepo structure” as the first M0 deliverable.\n\n## Current Behavior\n- Repo root contains only documentation, instructions, and `logs/` artifacts.\n- No `package.json`, `pnpm-workspace.yaml`, `turbo.json`, `tsconfig.base.json`, `.npmrc`, or `.nvmrc` are present.\n- No `apps/` or `packages/` directories exist yet, so there are no workspaces to install or build.\n\n## Root Cause Analysis\n- M0 bootstrap work has not been started. The monorepo structure is missing by design because this is Issue #1. This blocks all other M0 tasks (frontend/backend scaffolds, shared package, tooling, CI).\n\n## Impacted Modules / Areas\n- `apps/web` (SvelteKit) and `apps/api` (Fastify) cannot be scaffolded or wired into a workspace until the root config exists.\n- `packages/shared` cannot be created or consumed by apps until workspace resolution and base TS config exist.\n- Tooling and CI (lint/test/typecheck/build scripts, Turbo pipeline) are blocked.\n- All downstream issues in M0 are blocked by this task per MEMORY.md and the issue description.\n\n## Requirements & Constraints (from issue + docs)\n- Root monorepo structure:\n  - `apps/web`, `apps/api`, `packages/shared` directories.\n  - Root `package.json`, `pnpm-workspace.yaml`, `turbo.json`, `tsconfig.base.json`, `.npmrc`, `.nvmrc`.\n- Root `package.json` should include:\n  - pnpm workspace configuration (via `pnpm-workspace.yaml`).\n  - Shared scripts: `dev`, `build`, `lint`, `test`, `typecheck`, `clean`.\n  - Engines: Node >= 22, pnpm >= 9.\n- `.npmrc` must set `strict-peer-dependencies=true` and `auto-install-peers=true`.\n- `turbo.json` must define pipelines for `build`, `dev`, `lint`, `test`, `typecheck`.\n  - `build` depends on `^build` for package ordering.\n  - `dev` should be `persistent` and non-cached.\n- Node version pinned to 22 LTS in `.nvmrc`.\n- Architecture alignment:\n  - DD-08 Section 7 expects frontend routing groups and lib boundaries that presuppose `apps/web` structure.\n  - DD-09 Section 1.2 defines backend module layout under `apps/api/src/modules` and shared infra under `apps/api/src/shared`.\n  - DD-14 Section 12 stresses environment strategy; root config should keep environments reproducible (Node/pnpm pinning, consistent scripts).\n\n## Relevant Docs / References\n- `docs/MILESTONES.md` (M0 “Monorepo structure” deliverable, exit criteria).\n- `docs/DD/08_frontend_architecture_sveltekit.md` Section 7 (project structure, module boundaries).\n- `docs/DD/09_backend_architecture_api.md` Section 1.2 (module directory structure).\n- `docs/DD/14_design_document_integration_infrastructure.md` Section 12 (environment strategy).\n- `MEMORY.md` (M0 blocker: monorepo needs bootstrapping).\n\n## Alternative Approaches Considered\n- **Different workspace manager (npm/yarn/pnpm)**: Rejected by issue requirements and SOUL.md (pnpm 9.x mandated).\n- **No Turborepo**: Rejected by issue requirements; Turborepo is the orchestration standard in the repo.\n- **Delay creation of `apps/*` and `packages/*` directories**: Possible, but risks inconsistent scaffolding later and makes the “Monorepo structure” deliverable incomplete. Creating empty directories now aligns with the acceptance criteria and simplifies later scaffolding.\n- **Turbo config format (`pipeline` vs `tasks`)**: Must match the Turborepo version pinned in `package.json` once added. Using the wrong schema will break `turbo run`. Decide format based on the intended Turbo version (likely latest 2.x).\n\n## Risks / Edge Cases\n- **Turbo config schema mismatch** (e.g., `pipeline` vs `tasks`) can cause immediate CLI failure.\n- **Strict peer deps** in `.npmrc` may cause install failures if downstream packages declare incompatible peers. This is desired per requirement but will surface early.\n- **Missing `private: true` in root `package.json`** could allow accidental publish attempts in a monorepo.\n- **Workspace script names** should be consistent with later issues; mismatched script naming can cause downstream CI/dev tasks to fail.\n- **Empty workspaces**: `pnpm install` should still work, but some commands (`pnpm -r`) may show no packages until app scaffolds land.\n\n## Test Ideas / Validation Steps\n- `pnpm install` from repo root.\n- `pnpm -w run` should list root scripts (`dev`, `build`, `lint`, `test`, `typecheck`, `clean`).\n- `pnpm -w run build` should invoke Turbo without schema errors (even if no packages yet).\n- `turbo run build --dry` (or `pnpm turbo run build --dry`) to verify task graph ordering and `^build` dependencies.\n- Verify `.nvmrc` contains `22` (or `22.x`) and `node -v` is 22+.\n\n## Notes for Implementation Agent\n- Keep all work within repo root. Do not modify governance files (`SOUL.md`, `AGENTS.md`, `auto-develop.sh`).\n- Expect follow-on issues to add actual app/package `package.json` files and TS configs; this issue should only scaffold the root workspace and directories.\n","createdAt":"2026-02-05T16:50:49Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/TheMorpheus407/the-dmz/issues/1#issuecomment-3854895197","viewerDidAuthor":true},{"id":"IC_kwDOQ_FFzs7lyWxC","author":{"login":"TheMorpheus407"},"authorAssociation":"OWNER","body":"# Research: Issue #1 — Initialize pnpm monorepo workspace\n\n## Summary\nIssue #1 is the foundational M0 bootstrap: establish the pnpm/Turborepo monorepo skeleton (root configs + `apps/*` and `packages/*`). The repository currently contains only documentation and infra scripts; there is no workspace, no root `package.json`, and no app/package directories. This task is a hard blocker for all other M0 work because every subsequent scaffold (web, api, shared, tooling, CI) depends on a workspace root and shared configuration.\n\n## Current Behavior (Repo Scan)\n- Root contains docs/instructions only: `docs/`, `logs/`, `SOUL.md`, `MEMORY.md`, `.gitignore`, `.gitattributes`, etc.\n- No `apps/` or `packages/` directories exist.\n- No workspace configs exist: missing `package.json`, `pnpm-workspace.yaml`, `turbo.json`, `tsconfig.base.json`, `.npmrc`, `.nvmrc`.\n\n## Root Cause Analysis\n- M0 bootstrap has not started yet. This is explicitly the first issue in the milestone and is designed to create the workspace and pin core tooling versions.\n\n## Impacted Modules / Areas\n- `apps/web` and `apps/api` scaffolds are blocked until root config and workspace layout exist.\n- `packages/shared` cannot be created or consumed by apps without a pnpm workspace.\n- Any tooling or CI setup (lint/test/typecheck/build, Turbo pipeline, Husky) is blocked.\n- M0 exit criteria (\"pnpm dev starts both frontend and backend\") cannot be reached without this structure.\n\n## Requirements & Constraints (Issue + Docs)\n- Create root structure with `apps/web`, `apps/api`, `packages/shared` directories.\n- Add root configs: `package.json`, `pnpm-workspace.yaml`, `turbo.json`, `tsconfig.base.json`, `.npmrc`, `.nvmrc`.\n- Root `package.json`:\n  - Engine constraints: Node >= 22, pnpm >= 9.\n  - Shared scripts: `dev`, `build`, `lint`, `test`, `typecheck`, `clean`.\n  - Should be `private: true` to avoid accidental publishing (best practice for monorepo).\n- `.npmrc`:\n  - `strict-peer-dependencies=true`\n  - `auto-install-peers=true`\n- `.nvmrc`: pin Node 22 LTS.\n- `pnpm-workspace.yaml`: `apps/*`, `packages/*`.\n- `turbo.json`:\n  - Pipelines for `build`, `dev`, `lint`, `test`, `typecheck`.\n  - `build` depends on `^build`.\n  - `dev` is persistent and non-cached.\n- Architectural alignment:\n  - DD-08 Section 7 expects SvelteKit route groups and `src/lib` module boundaries under `apps/web`.\n  - DD-09 Section 1.2 defines backend module layout under `apps/api/src/modules` and `apps/api/src/shared`.\n  - DD-14 Section 12 emphasizes reproducible environments; root config should pin Node/pnpm and ensure consistent scripts.\n\n## Relevant Docs / References\n- `docs/MILESTONES.md`: M0 “Monorepo structure” deliverable and exit criteria.\n- `docs/DD/08_frontend_architecture_sveltekit.md`: Section 7 project structure and boundary rules.\n- `docs/DD/09_backend_architecture_api.md`: Section 1.2 module directory structure.\n- `docs/DD/14_design_document_integration_infrastructure.md`: Section 12 environment strategy and CI/CD expectations.\n- `MEMORY.md`: M0 blocker is monorepo bootstrap.\n\n## Open Decisions / Clarifications for Implementation\n- **Turborepo config schema**: `pipeline` vs `tasks` depends on the Turbo version chosen in root `package.json`. This must be aligned or `turbo run` will fail.\n- **Workspace package placeholders**: The acceptance criteria says \"Workspace packages can import from each other.\" If apps/packages remain empty directories, this can’t be validated. Options:\n  - Create empty directories only (minimal, avoids stepping on issues #2–#4).\n  - Create minimal `package.json` stubs for `apps/web`, `apps/api`, `packages/shared` now to allow basic workspace resolution. This may overlap with upcoming scaffolding issues, so coordination is needed.\n- **`packageManager` field**: Consider adding `\"packageManager\": \"pnpm@9.x\"` in root `package.json` for reproducibility (not required but consistent with DD-14 environment strategy).\n\n## Alternative Approaches Considered\n- **Use npm/yarn workspaces**: Rejected by SOUL.md and issue requirements (pnpm 9.x mandated).\n- **Skip Turbo**: Rejected; Turbo is required for build orchestration.\n- **Delay `apps/*` + `packages/*` directories**: Risks failing the “Monorepo structure” deliverable and complicates later scaffolds.\n\n## Risks / Edge Cases\n- **Turbo schema mismatch**: Using the wrong key (`pipeline` vs `tasks`) will make `turbo run` fail immediately.\n- **Strict peer dependencies**: `strict-peer-dependencies=true` can cause install failures once real packages are added (desired but may surface quickly).\n- **Script naming drift**: Inconsistent root script names could break later CI/dev automation.\n- **Empty workspaces**: `pnpm install` works, but `pnpm -r` and “import between packages” acceptance criteria may be impossible until app/package scaffolds exist.\n\n## Test / Validation Ideas\n- `pnpm install` completes from repo root.\n- `pnpm -w run` lists all root scripts (`dev`, `build`, `lint`, `test`, `typecheck`, `clean`).\n- `pnpm turbo run build --dry` verifies Turbo task graph and `^build` dependency ordering.\n- Verify `.nvmrc` contains `22` (or `22.x`), and local `node -v` satisfies engines.\n\n## Notes for Implementation Agent\n- Keep changes within repo root. Do not modify governance files (`SOUL.md`, `AGENTS.md`, `auto-develop.sh`).\n- This issue should only create the workspace skeleton; scaffolding apps/packages is handled in later issues.\n","createdAt":"2026-02-05T17:44:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/TheMorpheus407/the-dmz/issues/1#issuecomment-3855182914","viewerDidAuthor":true}],"createdAt":"2026-02-05T15:20:39Z","labels":[{"id":"LA_kwDOQ_FFzs8AAAACXIw6vQ","name":"M0: Bootstrap","description":"Milestone 0: Project Bootstrap","color":"1D76DB"},{"id":"LA_kwDOQ_FFzs8AAAACXIw7rw","name":"infrastructure","description":"CI/CD, Docker, DevOps","color":"0E8A16"},{"id":"LA_kwDOQ_FFzs8AAAACXIw9EQ","name":"devtools","description":"Developer tooling & DX","color":"C5DEF5"}],"number":1,"title":"M0-01: Initialize pnpm monorepo workspace","updatedAt":"2026-02-05T17:44:39Z","url":"https://github.com/TheMorpheus407/the-dmz/issues/1"}
