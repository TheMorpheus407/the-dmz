{"assignees":[],"author":{"id":"MDQ6VXNlcjIyODUzMjIy","is_bot":false,"login":"TheMorpheus407","name":"The Morpheus Tutorials"},"body":"## Summary\nConfigure Playwright for end-to-end testing with test database seeding, multi-browser support, and the first smoke test. This establishes the E2E testing pipeline referenced in DD-14 Section 12.2.\n\n## Requirements\n\n### Playwright Configuration (`playwright.config.ts`)\n- Located at monorepo root (tests span frontend + backend)\n- Base URL: `http://localhost:5173` (SvelteKit dev server)\n- API base URL: `http://localhost:3001` (Fastify dev server)\n- Browsers: Chromium, Firefox, WebKit\n- Retries: 0 locally, 2 in CI\n- Workers: 4 locally, 2 in CI\n- Screenshots on failure\n- Trace recording on first retry\n\n### Test Directory Structure\n```\ne2e/\n  fixtures/\n    base.ts              # Extended test with custom fixtures\n    auth.ts              # Authentication fixture (login helper)\n  helpers/\n    db-seed.ts           # Database seeding for E2E tests\n    api.ts               # API helper (direct API calls for setup)\n    cleanup.ts           # Test data cleanup\n  smoke/\n    health.spec.ts       # Verify app loads and API responds\n    navigation.spec.ts   # Verify route groups render\n  global-setup.ts        # Start services, run migrations, seed data\n  global-teardown.ts     # Cleanup test data\n```\n\n### Test Database Seeding\n- E2E tests use `dmz_test` database (separate from dev)\n- `global-setup.ts`:\n  1. Verify PostgreSQL and Redis are running\n  2. Run migrations against test database\n  3. Seed minimal test data (tenant, test user)\n- `global-teardown.ts`:\n  1. Clean up test data (or truncate tables)\n\n### First Smoke Tests\n```typescript\n// e2e/smoke/health.spec.ts\ntest('API health check returns 200', async ({ request }) => {\n  const response = await request.get('http://localhost:3001/health');\n  expect(response.ok()).toBeTruthy();\n});\n\ntest('Frontend loads without errors', async ({ page }) => {\n  await page.goto('/');\n  await expect(page).toHaveTitle(/DMZ/);\n});\n\n// e2e/smoke/navigation.spec.ts\ntest('Login page renders', async ({ page }) => {\n  await page.goto('/login');\n  await expect(page.locator('body')).toBeVisible();\n});\n```\n\n### Web Server Configuration\n- `webServer` config in Playwright to auto-start dev servers:\n  ```typescript\n  webServer: [\n    {\n      command: 'pnpm --filter api dev',\n      port: 3001,\n      reuseExistingServer: !process.env.CI,\n    },\n    {\n      command: 'pnpm --filter web dev',\n      port: 5173,\n      reuseExistingServer: !process.env.CI,\n    },\n  ],\n  ```\n\n### Scripts\n- `pnpm test:e2e` - Run all E2E tests\n- `pnpm test:e2e:ui` - Open Playwright UI mode\n- `pnpm test:e2e:headed` - Run in headed mode (visible browser)\n- `pnpm test:e2e:debug` - Debug mode with inspector\n\n### CI Integration\n- Playwright tests run in CI after unit tests pass\n- Uses `mcr.microsoft.com/playwright` container image\n- Screenshots and traces uploaded as artifacts on failure\n\n### Accessibility Testing Foundation\n- Install `@axe-core/playwright` for future a11y assertions\n- Placeholder test that runs axe on the home page\n\n## Acceptance Criteria\n- [ ] `pnpm test:e2e` runs Playwright tests successfully\n- [ ] Smoke tests verify both frontend and API are accessible\n- [ ] Test database is seeded before tests, cleaned after\n- [ ] Tests run in Chromium, Firefox, and WebKit\n- [ ] Screenshots are captured on test failure\n- [ ] Playwright UI mode works (`test:e2e:ui`)\n- [ ] Dev servers auto-start when running E2E tests\n- [ ] axe-core is installed and a basic a11y test placeholder exists\n- [ ] CI can run E2E tests with proper service containers\n\n## References\n- MILESTONES.md: M0 \"Testing infrastructure - Playwright (E2E), test database seeding\"\n- DD-14 Section 12.2: CI/CD Pipeline (Playwright E2E for critical flows)\n- DD-08 Section 24: Testing and Quality Strategy\n- Cross-cutting: Accessibility testing in CI\n\n## Dependencies\n- M0-02: SvelteKit frontend (must be running)\n- M0-03: Fastify backend (must be running)\n- M0-06: Docker Compose (PostgreSQL + Redis for test DB)\n- M0-07: Drizzle ORM (migrations for test DB)\n\n---","comments":[],"createdAt":"2026-02-05T15:23:53Z","labels":[{"id":"LA_kwDOQ_FFzs8AAAACXIw6vQ","name":"M0: Bootstrap","description":"Milestone 0: Project Bootstrap","color":"1D76DB"},{"id":"LA_kwDOQ_FFzs8AAAACXIw81A","name":"testing","description":"Testing infrastructure","color":"FBCA04"}],"number":14,"title":"M0-14: Set up Playwright E2E testing infrastructure","updatedAt":"2026-02-05T15:23:53Z","url":"https://github.com/TheMorpheus407/the-dmz/issues/14"}
