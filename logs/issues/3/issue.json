{"assignees":[],"author":{"id":"MDQ6VXNlcjIyODUzMjIy","is_bot":false,"login":"TheMorpheus407","name":"The Morpheus Tutorials"},"body":"## Summary\nInitialize the Fastify backend application in `apps/api` with the plugin-based modular monolith structure defined in DD-09. Set up the foundational directory layout, entry point, and health endpoints.\n\n## Requirements\n\n### Fastify Project Setup\n- Fastify 5.x with TypeScript\n- `tsx` for development (watch mode)\n- Node.js 22 LTS\n\n### Module Directory Structure (DD-09 Section 1.2)\n```\napps/api/\n  src/\n    server.ts                    # Entry point, Fastify instance creation\n    app.ts                       # Plugin registration, module loading\n    config.ts                    # Environment config with Zod validation\n    modules/\n      health/\n        index.ts\n        health.plugin.ts         # /health and /ready endpoints\n        health.routes.ts\n        health.service.ts\n    shared/\n      events/\n        event-bus.ts             # In-process event bus (placeholder)\n        event-types.ts\n      middleware/\n        error-handler.ts         # Global error handler\n        request-logger.ts        # Structured logging hook\n      database/\n        connection.ts            # PostgreSQL connection (placeholder)\n        redis.ts                 # Redis client (placeholder)\n        migrations/              # Migration directory\n      types/\n        fastify.d.ts             # Fastify type augmentations\n        common.ts                # Shared types (ApiResponse, Pagination)\n      utils/\n        id.ts                    # UUIDv7 generator\n        date.ts\n  package.json\n  tsconfig.json\n```\n\n> **Note:** The `shared/events/event-bus.ts` file is scaffolded as an empty placeholder here. The functional event bus implementation (DomainEvent<T> interface, publish/subscribe, error handling) is covered by #28 (M0-29).\n\n### Configuration\n- Environment variable validation with Zod (PORT, DATABASE_URL, REDIS_URL, NODE_ENV, LOG_LEVEL)\n- Pino structured JSON logging with field redaction (DD-09)\n- CORS configuration (dev: allow localhost origins)\n- Request ID propagation\n\n### Health Endpoints\n- `GET /health` - Basic liveness check\n- `GET /ready` - Readiness check (DB + Redis connectivity)\n- `GET /api/v1/` - API root with version info\n\n### Error Handling (DD-09)\n- Global error handler with standard response format:\n  ```json\n  {\n    \"success\": false,\n    \"error\": {\n      \"code\": \"ERROR_CODE\",\n      \"message\": \"Human-readable message\",\n      \"details\": {}\n    }\n  }\n  ```\n- ErrorCodes registry pattern\n\n## Acceptance Criteria\n- [ ] `pnpm --filter api dev` starts the server on port 3001\n- [ ] `GET /health` returns 200 with `{ status: \"ok\" }`\n- [ ] `GET /ready` returns 503 when DB not connected (graceful degradation)\n- [ ] Structured JSON logs with request IDs appear in stdout\n- [ ] Global error handler catches and formats all errors\n- [ ] Environment config validates on startup\n\n## References\n- DD-09 Section 1: Modular Monolith Architecture\n- DD-09 Section 2: Fastify Application Structure\n- DD-14 Section 14: Observability and Operational Tooling\n- MILESTONES.md: M0 \"Monorepo structure\" (Fastify backend)\n\n## Dependencies\n- M0-01: Initialize pnpm monorepo workspace\n\n## Related Issues\n- #28 (M0-29): In-process event bus implementation â€” handles the functional `DomainEvent<T>` interface, pub/sub, and error isolation for `shared/events/event-bus.ts`\n\n---","comments":[],"createdAt":"2026-02-05T15:21:12Z","labels":[{"id":"LA_kwDOQ_FFzs8AAAACXIw6vQ","name":"M0: Bootstrap","description":"Milestone 0: Project Bootstrap","color":"1D76DB"},{"id":"LA_kwDOQ_FFzs8AAAACXIw7OA","name":"backend","description":"Backend (Fastify)","color":"E8560C"}],"number":3,"title":"M0-03: Scaffold Fastify backend application","updatedAt":"2026-02-05T15:42:34Z","url":"https://github.com/TheMorpheus407/the-dmz/issues/3"}
